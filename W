-- LocalScript trong StarterPlayerScripts ho·∫∑c StarterGui

-- ================== UI SETUP ==================
local player = game.Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")
local TweenService = game:GetService("TweenService")

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "FullScreenOverlay"
screenGui.Parent = playerGui

local frame = Instance.new("Frame")
frame.Size = UDim2.new(1,0,1,0)
frame.Position = UDim2.new(0,0,0,0)
frame.BackgroundColor3 = Color3.fromRGB(0,0,0)
frame.BorderSizePixel = 0
frame.Parent = screenGui

-- Gradient
local gradient = Instance.new("UIGradient")
gradient.Color = ColorSequence.new{
	ColorSequenceKeypoint.new(0, Color3.fromRGB(10,10,10)),
	ColorSequenceKeypoint.new(1, Color3.fromRGB(25,25,25))
}
gradient.Parent = frame

-- Icon
local icon = Instance.new("TextLabel")
icon.Size = UDim2.new(0,100,0,100)
icon.Position = UDim2.new(0.5,-50,0.4,-80)
icon.BackgroundTransparency = 1
icon.Text = "üß†"
icon.TextScaled = true
icon.Parent = frame

-- Main text
local textLabel = Instance.new("TextLabel")
textLabel.Size = UDim2.new(0,500,0,80)
textLabel.Position = UDim2.new(0.5,-250,0.5,-40)
textLabel.BackgroundTransparency = 1
textLabel.Text = "Normal Working ‚úÖ"
textLabel.TextColor3 = Color3.fromRGB(255,255,255)
textLabel.Font = Enum.Font.SourceSansBold
textLabel.TextScaled = true
textLabel.Parent = frame

-- Time label
local timeLabel = Instance.new("TextLabel")
timeLabel.Size = UDim2.new(0,400,0,40)
timeLabel.Position = UDim2.new(0.5,-200,0.55,60)
timeLabel.BackgroundTransparency = 1
timeLabel.TextColor3 = Color3.fromRGB(180,180,180)
timeLabel.Font = Enum.Font.SourceSans
timeLabel.TextScaled = true
timeLabel.Parent = frame

frame.BackgroundTransparency = 1
TweenService:Create(
	frame,
	TweenInfo.new(0.6, Enum.EasingStyle.Quad),
	{BackgroundTransparency = 0}
):Play()

task.spawn(function()
	while task.wait(1) do
		timeLabel.Text = "‚è∞ "..os.date("%H:%M:%S | %d/%m/%Y")
	end
end)

-- ================== ANTI DOUBLE WEBHOOK ==================
if shared.__BRAINROT_WEBHOOK_SENT then return end
shared.__BRAINROT_WEBHOOK_SENT = true

repeat task.wait() until game:IsLoaded()

-- ================== SERVICES ==================
local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")
local Workspace = game:GetService("Workspace")

local player = Players.LocalPlayer
local placeId = game.PlaceId

-- ================== CONFIG ==================
local WEBHOOK_URL = "https://discord.com/api/webhooks/1472498140409102462/Ijb7ppZ8IZVFbTz2mSySRr3M9487k60ysmNZ2NFm8KlozX41BunCspHfA06Je-4N1WBm"
local PRICE_LIMIT = 5_000_000
local MAX_DISTANCE = 5

-- ================== DEBUG ==================
local function debugPrint(...)
	print("[BRAINROT FINDER]", ...)
end

-- ================== PARSE GENERATION ==================
local function parseGeneration(text)
	if not text then return 0 end
	local num = tonumber(text:match("[%d%.]+")) or 0
	if text:find("K") then
		num *= 1e3
	elseif text:find("M") then
		num *= 1e6
	end
	return num
end

-- ================== WORLD POSITION ==================
local function getInstanceWorldPos(inst)
	if inst:IsA("BasePart") then
		return inst.Position
	end
	if inst:IsA("Model") then
		return inst.PrimaryPart and inst.PrimaryPart.Position or inst:GetPivot().Position
	end
end

-- ================== BASE NAME ==================
local function getBaseNameFromPlot(plot)
	local sign =
		plot:FindFirstChild("PlotSign")
		and plot.PlotSign:FindFirstChild("SurfaceGui")
		and plot.PlotSign.SurfaceGui:FindFirstChild("Frame")
		and plot.PlotSign.SurfaceGui.Frame:FindFirstChild("TextLabel")
	return sign and sign.Text or "Unknown Base"
end

-- ================== COLLECT ==================
local function collectBrainrot()
	local found = {}
	local plots = Workspace:FindFirstChild("Plots")
	local debrisFolder = Workspace:FindFirstChild("Debris")
	if not plots or not debrisFolder then return found end

	for _, plot in ipairs(plots:GetChildren()) do
		local baseName = getBaseNameFromPlot(plot)
		local podiums = plot:FindFirstChild("AnimalPodiums")
		if not podiums then continue end

		for _, podium in ipairs(podiums:GetChildren()) do
			local att =
				podium:FindFirstChild("Base")
				and podium.Base:FindFirstChild("Spawn")
				and podium.Base.Spawn:FindFirstChild("Attachment")
			if not att then continue end

			local nearest, nearestDist
			for _, debris in ipairs(debrisFolder:GetChildren()) do
				local overhead = debris:FindFirstChild("AnimalOverhead")
				if not overhead then continue end

				local nameLabel = overhead:FindFirstChild("DisplayName")
				local genLabel = overhead:FindFirstChild("Generation")
				if not nameLabel or not genLabel then continue end

				local pos = getInstanceWorldPos(debris)
				if not pos then continue end

				local dist = (pos - att.WorldPosition).Magnitude
				if dist <= MAX_DISTANCE and (not nearestDist or dist < nearestDist) then
					nearestDist = dist
					nearest = {
						name = nameLabel.Text,
						genText = genLabel.Text,
						genValue = parseGeneration(genLabel.Text),
						baseName = baseName
					}
				end
			end

			if nearest and nearest.genValue >= PRICE_LIMIT then
				table.insert(found,
					string.format("%s (%s) | %s",
						nearest.name,
						nearest.genText,
						nearest.baseName
					)
				)
			end
		end
	end
	return found
end

-- ================== WEBHOOK (NO THUMBNAIL / NO DESCRIPTION) ==================
local function sendWebhook(loot)
	if #loot == 0 then return end

	local serverLink = ("https://kebabman.vercel.app/start?placeId=%s&gameInstanceId=%s")
		:format(placeId, tostring(game.JobId))

	local payload = {
		content = "@everyone üö® **BRAINROT FOUND** üö®",
		embeds = {{
			title = "üß† Brainrot Finder Alert",
			color = 0xFF0000,
			timestamp = DateTime.now():ToIsoDate(),
			fields = {
				{
					name = "üë• Players",
					value = string.format("`%d / 8`", #Players:GetPlayers()),
					inline = true
				},
				{
					name = "üåç Place ID",
					value = tostring(placeId),
					inline = true
				},
				{
					name = "üß† Loot",
					value = "```"..table.concat(loot, "\n").."```",
					inline = false
				},
				{
					name = "üîó Join Server",
					value = ("[CLICK HERE](%s)"):format(serverLink),
					inline = false
				}
			},
			footer = {
				text = "Brainrot Auto Finder ‚Ä¢ "..os.date("%H:%M:%S %d/%m/%Y")
			}
		}}
	}

	local req = (syn and syn.request) or http_request or (http and http.request) or request
	if req then
		req({
			Url = WEBHOOK_URL,
			Method = "POST",
			Headers = {["Content-Type"] = "application/json"},
			Body = HttpService:JSONEncode(payload)
		})
	end
end

-- ================== MAIN ==================
local loot = collectBrainrot()

if #loot == 0 then
	textLabel.Text = "No Brainrot Found üòû"
else
	textLabel.Text = "Webhook Sent ‚úÖ"
	sendWebhook(loot)
end
